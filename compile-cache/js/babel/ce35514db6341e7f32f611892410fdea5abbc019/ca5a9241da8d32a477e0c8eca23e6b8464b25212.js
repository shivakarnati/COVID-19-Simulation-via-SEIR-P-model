Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.isStringScope = isStringScope;
exports.forLines = forLines;
exports.isCommentScope = isCommentScope;
exports.isValidScopeToInspect = isValidScopeToInspect;
/** @babel */

var _atom = require('atom');

var juliaScopes = ['source.julia', 'source.embedded.julia'];
var openers = ['if', 'while', 'for', 'begin', 'function', 'macro', 'module', 'baremodule', 'type', 'immutable', 'struct', 'mutable struct', 'try', 'let', 'do', 'quote', 'abstract type', 'primitive type'];
var reopeners = ['else', 'elseif', 'catch', 'finally'];

function isKeywordScope(scopes) {
  // Skip 'source.julia'
  return scopes.slice(1).some(function (scope) {
    return scope.indexOf('keyword') > -1;
  });
}

function isStringScope(scopes) {
  var isString = false;
  var isInterp = false;
  for (var scope of scopes) {
    if (scope.indexOf('string') > -1) {
      isString = true;
    }
    if (scope.indexOf('interpolation') > -1) {
      isInterp = true;
    }
  }
  return isString && !isInterp;
}

function forRange(editor, range) {
  // this should happen here and not a top-level so that we aren't relying on
  // Atom to load packages in a specific order:
  var juliaGrammar = atom.grammars.grammarForScopeName('source.julia');

  if (juliaGrammar === undefined) return [];

  var scopes = [];
  var n_parens = 0;
  var n_brackets = 0;
  var text = editor.getTextInBufferRange(range);
  juliaGrammar.tokenizeLines(text).forEach(function (lineTokens) {
    lineTokens.forEach(function (token) {
      var value = token.value;

      if (!isStringScope(token.scopes)) {
        if (n_parens > 0 && value === ')') {
          n_parens -= 1;
          scopes.splice(scopes.lastIndexOf('paren'), 1);
          return;
        } else if (n_brackets > 0 && value === ']') {
          n_brackets -= 1;
          scopes.splice(scopes.lastIndexOf('bracket'), 1);
          return;
        } else if (value === '(') {
          n_parens += 1;
          scopes.push('paren');
          return;
        } else if (value === '[') {
          n_brackets += 1;
          scopes.push('bracket');
          return;
        }
      }
      if (!isKeywordScope(token.scopes)) return;
      if (!(n_parens === 0 && n_brackets === 0)) return;

      var reopen = reopeners.includes(value);
      if (value === 'end' || reopen) scopes.pop();
      if (openers.includes(value) || reopen) scopes.push(value);
    });
  });
  return scopes;
}

function forLines(editor, start, end) {
  var startPoint = new _atom.Point(start, 0);
  var endPoint = new _atom.Point(end, Infinity);
  var range = new _atom.Range(startPoint, endPoint);
  return forRange(editor, range);
}

function isCommentScope(scopes) {
  // Skip 'source.julia'
  return scopes.slice(1).some(function (scope) {
    return scope.indexOf('comment') > -1;
  });
}

/**
 * Returns `true` if the scope at `bufferPosition` in `editor` is valid code scope to be inspected.
 * Supposed to be used within Atom-IDE integrations, whose `grammarScopes` setting doesn't support
 * embedded scopes by default.
 */

function isValidScopeToInspect(editor, bufferPosition) {
  var scopes = editor.scopeDescriptorForBufferPosition(bufferPosition).getScopesArray();
  return scopes.some(function (scope) {
    return juliaScopes.includes(scope);
  }) ? !isCommentScope(scopes) && !isStringScope(scopes) : false;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3NoaXZha3Jpc2huYWthcm5hdGkvLnZhci9hcHAvaW8uYXRvbS5BdG9tL2RhdGEvcGFja2FnZXMvanVsaWEtY2xpZW50L2xpYi9taXNjL3Njb3Blcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7b0JBRTZCLE1BQU07O0FBRW5DLElBQU0sV0FBVyxHQUFHLENBQUMsY0FBYyxFQUFFLHVCQUF1QixDQUFDLENBQUE7QUFDN0QsSUFBTSxPQUFPLEdBQUcsQ0FDZCxJQUFJLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQy9GLFFBQVEsRUFBRSxnQkFBZ0IsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixDQUMzRixDQUFBO0FBQ0QsSUFBTSxTQUFTLEdBQUcsQ0FBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxTQUFTLENBQUUsQ0FBQTs7QUFFMUQsU0FBUyxjQUFjLENBQUUsTUFBTSxFQUFFOztBQUUvQixTQUFPLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUEsS0FBSyxFQUFJO0FBQ25DLFdBQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtHQUNyQyxDQUFDLENBQUE7Q0FDSDs7QUFFTSxTQUFTLGFBQWEsQ0FBRSxNQUFNLEVBQUU7QUFDckMsTUFBSSxRQUFRLEdBQUcsS0FBSyxDQUFBO0FBQ3BCLE1BQUksUUFBUSxHQUFHLEtBQUssQ0FBQTtBQUNwQixPQUFLLElBQU0sS0FBSyxJQUFJLE1BQU0sRUFBRTtBQUMxQixRQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7QUFDaEMsY0FBUSxHQUFHLElB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QUFHLGdCQUFVLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQTtBQUM3QyxTQUFPLFFBQVEsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUE7Q0FDL0I7O0FBRU0sU0FBUyxjQUFjLENBQUUsTUFBTSxFQUFFOztBQUV0QyxTQUFPLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUEsS0FBSyxFQUFJO0FBQ25DLFdBQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtHQUNyQyxDQUFDLENBQUE7Q0FDSDs7Ozs7Ozs7QUFPTSxTQUFTLHFCQUFxQixDQUFFLE1BQU0sRUFBRSxjQUFjLEVBQUU7QUFDN0QsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUNsQixnQ0FBZ0MsQ0FBQyxjQUFjLENBQUMsQ0FDaEQsY0FBYyxFQUFFLENBQUE7QUFDbkIsU0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQUEsS0FBSyxFQUFJO0FBQzFCLFdBQU8sV0FBVyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtHQUNuQyxDQUFDLEdBQ0EsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEdBQ2pELEtBQUssQ0FBQTtDQUNSIiwiZmlsZSI6Ii9ob21lL3NoaXZha3Jpc2huYWthcm5hdGkvLnZhci9hcHAvaW8uYXRvbS5BdG9tL2RhdGEvcGFja2FnZXMvanVsaWEtY2xpZW50L2xpYi9taXNjL3Njb3Blcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBAYmFiZWwgKi9cblxuaW1wb3J0IHsgUG9pbnQsIFJhbmdlIH0gZnJvbSAnYXRvbSdcblxuY29uc3QganVsaWFTY29wZXMgPSBbJ3NvdXJjZS5qdWxpYScsICdzb3VyY2UuZW1iZWRkZWQuanVsaWEnXVxuY29uc3Qgb3BlbmVycyA9IFtcbiAgJ2lmJywgJ3doaWxlJywgJ2ZvcicsICdiZWdpbicsICdmdW5jdGlvbicsICdtYWNybycsICdtb2R1bGUnLCAnYmFyZW1vZHVsZScsICd0eXBlJywgJ2ltbXV0YWJsZScsXG4gICdzdHJ1Y3QnLCAnbXV0YWJsZSBzdHJ1Y3QnLCAndHJ5JywgJ2xldCcsICdkbycsICdxdW90ZScsICdhYnN0cmFjdCB0eXBlJywgJ3ByaW1pdGl2ZSB0eXBlJ1xuXVxuY29uc3QgcmVvcGVuZXJzID0gWyAnZWxzZScsICdlbHNlaWYnLCAnY2F0Y2gnLCAnZmluYWxseScgXVxuXG5mdW5jdGlvbiBpc0tleXdvcmRTY29wZSAoc2NvcGVzKSB7XG4gIC8vIFNraXAgJ3NvdXJjZS5qdWxpYSdcbiAgcmV0dXJuIHNjb3Blcy5zbGljZSgxKS5zb21lKHNjb3BlID0+IHtcbiAgICByZXR1cm4gc2NvcGUuaW5kZXhPZigna2V5d29yZCcpID4gLTFcbiAgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzU3RyaW5nU2NvcGUgKHNjb3Blcykge1xuICBsZXQgaXNTdHJpbmcgPSBmYWxzZVxuICBsZXQgaXNJbnRlcnAgPSBmYWxzZVxuICBmb3IgKGNvbnN0IHNjb3BlIG9mIHNjb3Blcykge1xuICAgIGlmIChzY29wZS5pbmRleE9mKCdzdHJpbmcnKSA+IC0xKSB7XG4gICAgICBpc1N0cmluZyA9IHRydWVcbiAgICB9XG4gICAgaWYgKHNjb3BlLmluZGV4T2YoJ2ludGVycG9sYXRpb24nKSA+IC0xKSB7XG4gICAgICBpc0ludGVycCA9IHRydWVcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGlzU3RyaW5nICYmICFpc0ludGVycFxufVxuXG5mdW5jdGlvbiBmb3JSYW5nZSAoZWRpdG9yLCByYW5nZSkge1xuICAvLyB0aGlzIHNob3VsZCBoYXBwZW4gaGVyZSBhbmQgbm90IGEgdG9wLWxldmVsIHNvIHRoYXQgd2UgYXJlbid0IHJlbHlpbmcgb25cbiAgLy8gQXRvbSB0byBsb2FkIHBhY2thZ2VzIGluIGEgc3BlY2lmaWMgb3JkZXI6XG4gIGNvbnN0IGp1bGlhR3JhbW1hciA9IGF0b20uZ3JhbW1hcnMuZ3JhbW1hckZvclNjb3BlTmFtZSgnc291cmNlLmp1bGlhJylcblxuICBpZiAoanVsaWFHcmFtbWFyID09PSB1bmRlZmluZWQpIHJldHVybiBbXVxuXG4gIGNvbnN0IHNjb3BlcyA9IFtdXG4gIGxldCBuX3BhcmVucyA9IDBcbiAgbGV0IG5fYnJhY2tldHMgPSAwXG4gIGNvbnN0IHRleHQgPSBlZGl0b3IuZ2V0VGV4dEluQnVmZmVyUmFuZ2UocmFuZ2UpXG4gIGp1bGlhR3JhbW1hci50b2tlbml6ZUxpbmVzKHRleHQpLmZvckVhY2gobGluZVRva2VucyA9PiB7XG4gICAgbGluZVRva2Vucy5mb3JFYWNoKHRva2VuID0+IHtcbiAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRva2VuXG4gICAgICBpZiAoIWlzU3RyaW5nU2NvcGUodG9rZW4uc2NvcGVzKSkge1xuICAgICAgICBpZiAobl9wYXJlbnMgPiAwICYmIHZhbHVlID09PSAnKScpIHtcbiAgICAgICAgICBuX3BhcmVucyAtPSAxXG4gICAgICAgICAgc2NvcGVzLnNwbGljZShzY29wZXMubGFzdEluZGV4T2YoJ3BhcmVuJyksIDEpXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH0gZWxzZSBpZiAobl9icmFja2V0cyA+IDAgJiYgdmFsdWUgPT09ICddJykge1xuICAgICAgICAgIG5fYnJhY2tldHMgLT0gMVxuICAgICAgICAgIHNjb3Blcy5zcGxpY2Uoc2NvcGVzLmxhc3RJbmRleE9mKCdicmFja2V0JyksIDEpXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICcoJykge1xuICAgICAgICAgIG5fcGFyZW5zICs9IDFcbiAgICAgICAgICBzY29wZXMucHVzaCgncGFyZW4nKVxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAnWycpIHtcbiAgICAgICAgICBuX2JyYWNrZXRzICs9IDFcbiAgICAgICAgICBzY29wZXMucHVzaCgnYnJhY2tldCcpXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghKGlzS2V5d29yZFNjb3BlKHRva2VuLnNjb3BlcykpKSByZXR1cm5cbiAgICAgIGlmICghKG5fcGFyZW5zID09PSAwICYmIG5fYnJhY2tldHMgPT09IDApKSByZXR1cm5cblxuICAgICAgY29uc3QgcmVvcGVuID0gcmVvcGVuZXJzLmluY2x1ZGVzKHZhbHVlKVxuICAgICAgaWYgKHZhbHVlID09PSAnZW5kJyB8fCByZW9wZW4pIHNjb3Blcy5wb3AoKVxuICAgICAgaWYgKG9wZW5lcnMuaW5jbHVkZXModmFsdWUpIHx8IHJlb3Blbikgc2NvcGVzLnB1c2godmFsdWUpXG4gICAgfSlcbiAgfSlcbiAgcmV0dXJuIHNjb3Blc1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9yTGluZXMgKGVkaXRvciwgc3RhcnQsIGVuZCkge1xuICBjb25zdCBzdGFydFBvaW50ID0gbmV3IFBvaW50KHN0YXJ0LCAwKVxuICBjb25zdCBlbmRQb2ludCA9IG5ldyBQb2ludChlbmQsIEluZmluaXR5KVxuICBjb25zdCByYW5nZSA9IG5ldyBSYW5nZShzdGFydFBvaW50LCBlbmRQb2ludClcbiAgcmV0dXJuIGZvclJhbmdlKGVkaXRvciwgcmFuZ2UpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0NvbW1lbnRTY29wZSAoc2NvcGVzKSB7XG4gIC8vIFNraXAgJ3NvdXJjZS5qdWxpYSdcbiAgcmV0dXJuIHNjb3Blcy5zbGljZSgxKS5zb21lKHNjb3BlID0+IHtcbiAgICByZXR1cm4gc2NvcGUuaW5kZXhPZignY29tbWVudCcpID4gLTFcbiAgfSlcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgc2NvcGUgYXQgYGJ1ZmZlclBvc2l0aW9uYCBpbiBgZWRpdG9yYCBpcyB2YWxpZCBjb2RlIHNjb3BlIHRvIGJlIGluc3BlY3RlZC5cbiAqIFN1cHBvc2VkIHRvIGJlIHVzZWQgd2l0aGluIEF0b20tSURFIGludGVncmF0aW9ucywgd2hvc2UgYGdyYW1tYXJTY29wZXNgIHNldHRpbmcgZG9lc24ndCBzdXBwb3J0XG4gKiBlbWJlZGRlZCBzY29wZXMgYnkgZGVmYXVsdC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzVmFsaWRTY29wZVRvSW5zcGVjdCAoZWRpdG9yLCBidWZmZXJQb3NpdGlvbikge1xuICBjb25zdCBzY29wZXMgPSBlZGl0b3JcbiAgICAuc2NvcGVEZXNjcmlwdG9yRm9yQnVmZmVyUG9zaXRpb24oYnVmZmVyUG9zaXRpb24pXG4gICAgLmdldFNjb3Blc0FycmF5KClcbiAgcmV0dXJuIHNjb3Blcy5zb21lKHNjb3BlID0+IHtcbiAgICByZXR1cm4ganVsaWFTY29wZXMuaW5jbHVkZXMoc2NvcGUpXG4gIH0pID9cbiAgICAhaXNDb21tZW50U2NvcGUoc2NvcGVzKSAmJiAhaXNTdHJpbmdTY29wZShzY29wZXMpIDpcbiAgICBmYWxzZVxufVxuIl19